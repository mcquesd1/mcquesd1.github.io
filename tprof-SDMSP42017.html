<!DOCTYPE html>
<html>

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Scott McQueen - Portfolio</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link href="https://fonts.googleapis.com/css?family=Droid+Sans:400,700" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/baguettebox.js/1.8.1/baguetteBox.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
    <link rel="stylesheet" href="thumbnail-gallery.css">
    <link rel="icon" href="banner.jpg">
</head>

<body>

    <div class="container">

        <nav class="navbar navbar-inverse navbar-fixed-top">

            <div class="navbar-header">
                <button type="button" id="btnCollapse" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
                                                        <span class="sr-only">Toggle navigation</span>
                                                        <span class="icon-bar"></span>
                                                        <span class="icon-bar"></span>
                                                        <span class="icon-bar"></span>
                                                      </button>

                <a class="navbar-brand" href="index.html">Scott McQueen : Portfolio Home</a>
            </div>
            <div id="navbar" class="collapse navbar-collapse">
                <ul class="nav navbar-nav">
                    <li><a href="pprof.html">Professional Proficiency</a></li>
                    <li><a href="timeline.html">Timeline</a></li>
                    <li class="active"><a href="tprof.html">Technical Proficiency</a></li>
                    <li><a href="CV.html">Curriculum Vitae</a></li>
                    <li><a href="journey.html">The Journey</a></li>
                    <li><a href="links.html">Links & Resources</a></li>
                </ul>
            </div>
        </nav>

        <span class="padder"></span>

        <h1 class="text-center">Work Project</h1>
        <br><br>
        <h2>Introduction</h2>
        <p>I have been tasked with designing and creating various modules to carry out business processes required by my employer. The modules will use the Microsoft applications, Sharepoint as their data source, Power automate to provide workflow automation,
            and Powerapps as the user interface if required. The modules documented here are:</p>
        <ol>
            <li>Bankings notifications module</li>
            <li>Venue payment analysis distribution</li>
            <li>Venue agreement expiry notifications</li>
        </ol>
        <br><br>
        <h2 class="text-center">Banking notifications module</h2>
        <br>
        <h3>Overview</h3>

        <p>To create an application that will enable staff to send notifications to key venue personnel notifying them of banking figures.
        </p>
        <br>
        <h3>Background</h3>

        <p>Venues generate GMP (gaming machine profit) and a weekly return amount is calculated each Monday. Venues have 5 days to bank the weekly return amount. The finance department produce twice weekly a txt file from the accounting system. The Monday
            file contains the banking figure generated from the previous week’s activity. The Friday file contains the current arrears for the venues. This arrears needs to be banked on the Friday to stay within the 5 days period. The notifications required
            are:
        </p>
        <ul>
            <li>Monday - Email</li>
            <li>Monday - SMS</li>
            <li>Friday - Email</li>
            <li>Friday - SMS</li>
        </ul>
        <h3>Data</h3>

        <p>The data required for the module comes from two sources. The Key Persons Sharepoint list, and the txt file produced by the finance department, which is uploaded to the Bankings Due Sharepoint list. Figure 1 shows sample data from the upload file.<br>            Figure 1. Banking due txt file</p>


        <center><img src="f1banking.png" alt="GIT screenshot" width="900px"></center>
        <br>
        <p>Each key person can opt in for both Monday and Friday notifications via email and/or SMS. Figure 2 shows a sample of abbreviated data (notification preferences only) from the key persons list. Each full key person record has 32 properties. <br>Figure
            2. Key persons list showing notification preferences.
        </p>
        <center><img src="f2banking.png" alt="GIT screenshot" width="900px"></center><br>
        <h4>Data upload</h4>

        <p>There are two options for uploading the banking data from the text file to Sharepoint:<br>
        </p>
        <ol>
            <li>Data can be copied and pasted into a Sharepoint list by entering “quick edit” mode. Place the cursor in the first empty column and paste.</li>
            <center><img src="spquickedit.jpg" alt="GIT screenshot" width="900px"></center>
            <br>
            <li>A Powershell script can upload the data to the list.</li>
            <center><img src="script.jpg" alt="GIT screenshot" width="700px"></center>
        </ol>
        <br>
        <p>The Powershell script was the preferred method as it meant users didn’t have to interact with the Sharepoint list itself. To enable each user (there are four possible users) to be able to run the script the Powershell PNP Sharepoint Online cmdlets
            needed to be installed on each machine. The install instructions and documentation for this is <a href="https://docs.microsoft.com/en-us/powershell/sharepoint/sharepoint-pnp/sharepoint-pnp-cmdlets?view=sharepoint-ps#setup-files" target="new">here</a>.
            I used a bat file placed in a shared drive for users to run the script.
        </p>
        <code><strong><p class="text-center">powershell.exe -ExecutionPolicy Bypass -file BankingsToSharePointList.ps1</p></strong></code>
        <br><br>
        <h3>Power Automate</h3>
        <div class="row">
            <div class="col-md-9">
                <p class="text-left">
                    Power automate offers 3 ways to make a flow; automated, instant, and scheduled. For this project I used an automated flow that would trigger based on an event. There are a large number of triggers to choose from. I searched the Sharepoint triggers and
                    used “When an item is created” since I wanted the flow to run when an item is created in the bankings due list. Once a trigger is defined the rest of the flow carries out a set of chosen actions. Like triggers there are many actions
                    to choose from such as:
                </p>
                <ul class="text-left">
                    <li>data maintenance (create, update, delete items)</li>
                    <li>process control (conditional statements, loops, switches</li>
                    <li>data operations (variables, table creation)</li>
                    <li>app integration (mail, excel, Onedrive, SMS providers)</li>
                </ul>
            </div>
            <div class="col-md-3">
                <img alt="Bootstrap Image Preview" width="300px" src="flowoptions.jpg" />
            </div>
        </div>
        <h4>Notification Logic</h4>
        <div class="row">
            <div class="col-md-9">
                <p class="text-left">
                    The chart shows the basic process involved. When an item is created in the BankingsDue list the flow is triggered. Data from the BankingsDue and Key Persons lists are retrieved. The process loops through the records looking for a match on venue number
                    in the BankingsDue and KeyPersons lists. An additional condition is evaluated to check if the key person has opted in to receive the notification. If the condition is evaluated as true, an email is populated with dynamic content, the
                    venue's banking figure, and sent to the key person email address.
            </div>
            <div class="col-md-3">
                <img alt="Bootstrap Image Preview" width="300px" src="fflogic.jpg" />
            </div>
        </div>
        <h4>Creating the first flow in Power Automate</h4>
        <center><img alt="Bootstrap Image Preview" width="300px" src="ff1.jpg" /></center>
        <center><img alt="Bootstrap Image Preview" width="700px" src="ff2.png" /></center><br>
        <h4>First run reflection</h4>
        <p>The flow worked however it ran 50 times, once for each item that was added to the Bankings Due list. Depending on what subscription you have there can be limits on the number of flows you can run. I decided the current model was not very scalable
            and could cause issues in the future if additional flows were added. I decided to create a new trigger list. The idea then was to upload the banking items as usual, then trigger 1 flow that would evaluate all 50 items on the bankings due list.
            The new trigger list contained a simple reference field as well as a staff name. By showing this information in the user interface staff could see a history of notifications including the date and time they were executed. This proved to be
            beneficial as previously there was no way for a user to find out the flow history.
        </p><br>
        <h4>SMS Notifications</h4>
        <p>I began using the Nexmo and Telesign connectors available through Power Automate. I created accounts and ran tests. I had issues sending SMS messages to Vodafone numbers. They were reported as being successfully sent but weren’t being received.
            Further to that there was a lack of functionality available from these connectors. Our current legacy system uses a NZ based provider. Here we create a CSV file containing all required information. The CSV is emailed to the provider for distribution.
            Their system offers 2 way communication where a dialogue between us and the operator can occur and be documented. SMS replies are sent to the email address that was used to send the SMS. I decided to try and emulate this functionality with
            Power Automate. This proved a challenge due to limitations in Power Automate. The “create CSV table” action would only except input from one source. Because I needed fields coming from both the Bankings Due and Key Persons lists a workaround
            was required. I added a new Sharepoint list and used the “create item” action which can include multiple sources. This enabled me to create the CSV with the output from the newly created list.

        </p><br>
        <p>SMS flow creating CSV table</p>
        <center><img alt="Bootstrap Image Preview" width="700px" src="smsflow.jpg" /></center>
        <center><img alt="Bootstrap Image Preview" width="400px" src="smsflow2.jpg" /></center><br>
        <h4>Making the process efficient</h4>
        <p>Efficiencies can be made by creating views in a Sharepoint list that limit the number of columns returned. The Key Persons list is a good example of this as there is 32 columns, but I created a view that contained only relevant columns to the
            notifications process. Further efficiencies can be made by filtering the data being passed into the flows at the beginning rather than using conditional statements operating on larger data sets. Power Automate offers OData filter queries to
            restrict the amount of data that is evaluated. I used this filtering to bring in only the required data. There are some gotchas when working with different applications as some have differing conditional logic syntax. The table below shows
            a Boolean field example. </p><br>
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Application</th>
                    <th>True value</th>
                    <th>False value</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Sharepoint list</td>
                    <td>Yes</td>
                    <td>No</td>
                </tr>
                <tr>
                    <td>Power Automate</td>
                    <td>True</td>
                    <td>False</td>
                </tr>
                <tr>
                    <td>OData Filter</td>
                    <td>1</td>
                    <td>0</td>
                </tr>
            </tbody>
        </table><br>
        <h4>Refining the process</h4>
        <p>
            As the banking notifications were a twice weekly event containing new and different data each time, consideration needed to be given to data maintenance of the Sharepoint list that feeds the notifications. To acomplish this I created a scheduled flow
            in Power Automate to purge the list of all entries. This flow would run the day before the Notification send date. The SMS process needed additional consideration given to data management. For this process I added actions to the flow that
            would delete both the list items that populated the CSV file, and the CSV file itself before creating the new file. I also personalised the message to venue operators by adding the user name entered from the initial trigger.
        </p>
        <br>
        <h4>User Interface</h4>
        <p>

        </p>
        <div class="panel panel-default">
            <div class="panel-body">
                <div class="text-center">
                    <img src="slackrs.JPG" alt="slack screenshot">
                </div>
            </div>
        </div>
        <div class="panel panel-default">
            <div class="panel-body">
                <div class="text-center">
                    <img src="slackrs1.JPG" alt="slack screenshot">
                </div>
            </div>
        </div>
        <div class="panel panel-default">
            <div class="panel-body">
                <div class="text-center">
                    <img src="slackrs2.JPG" alt="slack screenshot">
                </div>
            </div>
        </div>
        <div class="panel panel-default">
            <div class="panel-body">
                <div class="text-center">
                    <img src="slackrs3.JPG" alt="slack screenshot">
                </div>
            </div>
        </div>

        <h3>Code contributions</h3>
        <div class="panel panel-default">
            <div class="panel-body">
                <div class="text-center">
                    <img src="slackc.JPG" alt="slack screenshot">
                </div>
            </div>
        </div>
        <div class="panel panel-default">
            <div class="panel-body">
                <div class="text-center">
                    <img src="slackc1.JPG" alt="slack screenshot">
                </div>
            </div>
        </div>
        <div class="panel panel-default">
            <div class="panel-body">
                <div class="text-center">
                    <img src="slackc2.JPG" alt="slack screenshot">
                </div>
            </div>
        </div>

        <div class="panel panel-default">
            <div class="panel-body">
                <div class="text-center">
                    <img src="slackc4.JPG" alt="slack screenshot">
                </div>
            </div>
        </div>


        <span class="padder2"></span>

    </div>
    <div id="footer">
        <div class="text-center">Scott McQueen - Software Engineering Portfolio 2017
            <p><a id="femail" href="mailto:mcquesd1@student.op.ac.nz">mcquesd1@student.op.ac.nz</a></p>
        </div>
    </div>
    <script>
        //Collapsible navbar script. Collapses the menu when a link is clicked
        $(".a").click(function() {
            if ($("#btnCollapse").css('display') != 'none')
                $("#btnCollapse").click();
        });
    </script>
</body>

</html>